# Демонстрационный проект на FastAPI

Это приложение представляет собой API для доступа к каталогу видеофайлов.

Используются следующие компоненты:
- [FastAPI](https://fastapi.tiangolo.com/)
- [SQLModel](https://sqlmodel.tiangolo.com/)
- [SQLAlchemy](https://www.sqlalchemy.org/)
- [PostgreSQL](https://www.postgresql.org/)
- [Docker](https://www.docker.com/)

## Настройки

Для хранения наcтроек приложения используется пакет [pydantic-settings](https://pypi.org/project/pydantic-settings/), настройки находятся в файле [config.py](app/config.py).

Настройки приложения могут загружаться из переменных среды или файла `.env`. Пример заполнения настроек приведен в файле [.env_sample](.env_sample):

- DB_SCHEME=postgresql+asyncpg - схема подключения к базе данных
- DB_HOST=postgres - адрес подключения к базе данных
- DB_PORT=5432 - порт подключения к базе данных
- DB_USER=postgres - имя пользователя базы данных и самой базы данных
- DB_PASSWORD=password - пароль пользователя базы данных

Если предполагается использование файла `.env`, его нужно создать и скопировать туда содержимое файла [.env_sample](.env_sample).

Настройки используются как приложением, так и контейнером PostgreSQL для собственной инициализации (при использовании Docker).

## Запуск с помощью Docker

Запуск выполняется командой
```shell
docker compose up --build
```

При этом выполняется сценарий в файле [docker-compose.yaml](./docker-compose.yaml) с запуском двух контейнеров: приложения и базы данных. Ключ `--build` запускает принудительную пересборку образа приложения. Если исходный код приложения не менялся со времени последнего запуска, этот ключ можно опустить.


## Документация API

После запуска приложения автодокументация API доступна по локальному адресу [http://127.0.0.1:8000/docs](http://127.0.0.1:8000/docs).


## Запуск с помощью менеджера пакетов UV

### Запуск локального сервера для отладки

```shell
uv run uvicorn app.main:app --port=8000 --reload
```
или
```shell
uv run -m app.main
```

### Запуск локального сервера PostgreSQL в контейнере Docker

Если отладку предполагается проводить с базой данных PostgreSQL, можно запустить локальный сервер следующей командой:

```shell
docker compose -f docker-compose-postgres.yaml up
```

При этом важно изменить настройку `DB_HOST`, задав ей значение `localhost`.